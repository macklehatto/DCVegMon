---
title: "Vegetation Monitoring Analysis"
author: "Manhatton"
date: "2/3/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

##install packages
#install.packages('skimr', repos = "http://cran.us.r-project.org")
#install.packages('kableExtra', repos = "http://cran.us.r-project.org")
#install.packages('janitor', repos = "http://cran.us.r-project.org")

## attach libraries
library(tidyverse)
library(readxl)
library(janitor)
library(dplyr)
library(here)

library(skimr)  
library(kableExtra)  

##Find all xlsx within directory
 file.list <- list.files(here("Data"), pattern = '*.xlsx', full.names = TRUE)

 extract_data <- function(x)
{
woody <- read_xlsx(here("data", x), sheet = "Woody", skip = 8)%>%
  janitor::clean_names() %>%
  janitor::remove_empty(c("rows"))

forbs <- read_xlsx(here("data", x), sheet = "Forbs", skip = 8)%>%
  janitor::clean_names() %>%
  janitor::remove_empty(c("rows"))

grasses <- read_xlsx(here("data", x), sheet = "Grasses", skip = 8)%>%
  janitor::clean_names() %>%
  janitor::remove_empty(c("rows"))

relevecode <- read_xlsx(here("data", x), sheet = "Woody", range = "C2:C2", col_names = FALSE) #grabs the relevecode from C2 of Woody sheet

data_frame = (bind_rows(woody, forbs, grasses))
  
data_frame['releveCode'] = list(relevecode[[1,1]])
  
  return(df)
}

all_df <- data.frame("scientific_name"=character(), "common_name"=character(), "x3" =numeric(), "physiognamy"=character(), "mn_nativity" = character(), "mnwi"= character(), "rarity_status" = character(), "id" = character(), "cc" = numeric(), "cc_range" = character(), "x12" = numeric(), "midpoint_cc"= numeric(), "p" = numeric(), "p_c" = numeric(), releveCode = character()) # schema for final table (same schema as single_df)

for (x in file.list){
  single_df <- extract_data(x)
  all_df <- rbind(all_df, single_df)
}


## reads data from a single xls

x <- "LHHL5p.xlsx" ## assign variable to target filename

relevecode <- read_xlsx(here("data", "LHHL5p.xlsx"), sheet = "Woody", range = "C2:C2", col_names = FALSE) #grabs the relevecode from C2 of Woody sheet

woody <- read_xlsx(here("data", "LHHL5p.xlsx"), sheet = "Woody", skip = 8)%>%
  janitor::clean_names() %>%
  janitor::remove_empty(c("rows"))

forbs <- read_xlsx(here("data", x), sheet = "Forbs", skip = 8)%>%
  janitor::clean_names() %>%
  janitor::remove_empty(c("rows"))

grasses <- read_xlsx(here("data", x), sheet = "Grasses", skip = 8)%>%
  janitor::clean_names() %>%
  janitor::remove_empty(c("rows"))

## append woody, forb and grass tables together add column containing survey code (from Woody cell C2)

data_frame = (bind_rows(woody, forbs, grasses))
  
data_frame['releveCode'] = list(relevecode[[1,1]]) #double bracket removes value from the df





```

## R Markdown

Project to do:
-read 2020 and 2021 releve data
-read GRG reference (ordination folder)
-Table: Releve, Species, Midpoint % Cover (column M)
-For our data: Need to add name column to each - in C2 of Woody tab - add column (2020, 2021)
-For GRG data: the name will be in the NPC Code
-Pull in the Compiled Releve Data for R, sheet1 - add year column
-Create matrix

-find all xls in directory (list all files)
-store as array
-1. loop or 2. create function 

extract_data <- function(x){
  # code for extracting data using filename x
  return(df)
}

all_df <- extract_data(filenames[1])

for (x in filenames[-1]){
  single_df <- extract_data(x)
  all_df <- rbind(all_df, single_df)
}
}

```{r df}
print(code)
summary(data_frame)
head(data_frame)

```

