---
title: "Vegetation Monitoring Analysis"
author: "Manhatton"
date: "2/3/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

##install packages
#install.packages('skimr', repos = "http://cran.us.r-project.org")
#install.packages('kableExtra', repos = "http://cran.us.r-project.org")
#install.packages('janitor', repos = "http://cran.us.r-project.org")

## attach libraries
library(tidyverse)
library(readxl)
library(janitor)
library(dplyr)
library(here)

library(skimr)  
library(kableExtra)  


##Find all releve xlsx within directory
file.list <- list.files("C:\\Users\\Meg\\OneDrive - University of Nebraska-Lincoln\\R practice\\DCVegMon\\data\\", pattern = '*.xlsx', full.names = TRUE)

## Extract data from woody, forbs and grasses worksheets

 extract_data <- function(x)
{
woody <- read_xlsx(x, sheet = "Woody", skip = 8)%>%
  janitor::clean_names() %>%
  janitor::remove_empty(c("rows"))%>%
  mutate(rarity_status = as.character(rarity_status)) %>%
  select("scientific_name", "common_name", "x3" , "physiognamy", "mn_nativity", "mnwi", "rarity_status" = , "id" , "cc" , "cc_range", "x12" , "midpoint_cc", "p", "p_c")

forbs <- read_xlsx(x, sheet = "Forbs", skip = 8)%>%
 janitor::clean_names() %>%
 janitor::remove_empty(c("rows"))%>%
 mutate(rarity_status = as.character(rarity_status))  %>%
 select("scientific_name", "common_name", "x3" , "physiognamy", "mn_nativity", "mnwi", "rarity_status" = , "id" , "cc" , "cc_range", "x12" , "midpoint_cc", "p", "p_c")
  
grasses <- read_xlsx(x, sheet = "Grasses", skip = 8)%>%
  janitor::clean_names() %>%
  janitor::remove_empty(c("rows"))%>%
  mutate(rarity_status = as.character(rarity_status)) %>%
  select("scientific_name", "common_name", "x3" , "physiognamy", "mn_nativity", "mnwi", "rarity_status" = , "id" , "cc" , "cc_range", "x12" , "midpoint_cc", "p", "p_c")

relevecode <- read_xlsx(x, sheet = "Woody", range = "C2:C2", col_names = FALSE) #grabs the relevecode from C2 of Woody sheet
print(relevecode)

 data_frame <- (bind_rows(woody, forbs, grasses)) #combine the woody, forbs, and grasses data rows

 data_frame['releveCode'] <- list(relevecode[[1,1]]) #assign value from woody cell C2 to new column in combined dataframe (indicates releve code)
  
  return(data_frame)
}

##create empty dataframe with all the required columns
 
all_df <- data.frame("scientific_name"=character(), "common_name"=character(), "x3" =numeric(), "physiognamy"=character(), "mn_nativity" = character(), "mnwi"= character(), "rarity_status" = character(), "id" = character(), "cc" = numeric(), "cc_range" = character(), "x12" = numeric(), "midpoint_cc"= numeric(), "p" = numeric(), "p_c" = numeric(), releveCode = character()) 

##loop through all files in the folder 

for (x in file.list){
  print(x)
  single_df <- extract_data(x)
  all_df <- rbind(all_df, single_df)
}

##removes all rows with greater than 10 "NA" cells 

hi <- apply(all_df, 1, function(x) sum(is.na(x)))

all_df <- all_df[hi<10,]

##checking that everything imported

all_df %>% group_by(releveCode) %>% count()
check <- all_df %>% group_by(releveCode) %>% count()

##create new dataframe with just the scientific name, midpoint % cover, releve 

ordination_df <- 

```



## R Markdown

Project to do:
xread 2020 and 2021 releve data
-read GRG reference (ordination folder)
-Table: Releve, Species, Midpoint % Cover (column M)
-For our data: Need to add name column to each - in C2 of Woody tab - add column (2020, 2021)
-For GRG data: the name will be in the NPC Code
-Pull in the Compiled Releve Data for R, sheet1 - add year column
-Create matrix

-find all xls in directory (list all files)
-store as array
-1. loop or 2. create function 

extract_data <- function(x){
  # code for extracting data using filename x
  return(df)
}

all_df <- extract_data(filenames[1])

for (x in filenames[-1]){
  single_df <- extract_data(x)
  all_df <- rbind(all_df, single_df)
}
}

```{r df}
print(code)
summary(data_frame)
head(data_frame)

```

